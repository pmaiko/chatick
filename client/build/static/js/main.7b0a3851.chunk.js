(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[0],{127:function(e,t){},131:function(e,t,a){},132:function(e,t,a){},133:function(e,t,a){"use strict";a.r(t);var s=a(0),r=a.n(s),n=a(32),c=a.n(n),o=a(35),m=a(18),i=a(70),l=a(1),u="LOGIN",d="CHECK_LOGGED",p="LOGOUT",h="SOCKET_ID",g=a(16),f=a.n(g),v="".concat(window.location.protocol,"/api/v1/"),E="".concat(window.location.host),N=function(e,t){f.a.post(v+"register-user",e).then((function(e){t(e)}))},_=function(e,t){f.a.post(v+"login",e).then((function(e){t(e)}))},b=a(34),k=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:window.localStorage.getItem("token"),t={};if(e){var a=e;t.token=a;(a=(a=a.replace("Bearer ","")).split("."))[0];var s=a[1];a[2];s=JSON.parse(b.Base64.decode(s)),t.userId=s.userId,t.firstName=s.firstName,t.lastName=s.lastName,t.email=s.email,f.a.defaults.headers.common.Authorization=e,t.logged=!0,localStorage.setItem("token",e)}return t},I={login:function(e,t){var a=this;return function(s){_({email:e,password:t},(function(e){var t=k(e.data);s(a.loginRequest(Object(l.a)({type:u},t)))}))}},loginRequest:function(e){return e},checkLogged:function(){var e=k();return Object(l.a)({type:d},e)},logout:function(){return{type:p}}},O={logged:!1,token:void 0,userId:"",firstName:"",lastName:"",email:""};var y={socketId:""};var j=Object(m.c)({auth:function(e,t){if("undefined"===typeof e)return O;switch(t.type){case u:e=Object(l.a)({},t);break;case d:t.token?e=Object(l.a)({},t):(e.token=void 0,e.logged=!1);break;case p:window.localStorage.removeItem("token"),f.a.defaults.headers.common.Authorization="",e.token=void 0,e.logged=!1}return e},s_socket:function(e,t){if("undefined"===typeof e)return y;switch(t.type){case h:e.socketId=t.socketId}return e}}),w={writeSocketId:function(e){return{type:h,socketId:e}}},S=Object(l.a)({},I,{},w),C=function(e){return Object(l.a)({},e)},M=Object(l.a)({},S),P=function(e){return Object(o.b)(C,M)(e)},x=a(13),F=a(12);var L=P((function(e){var t=Object(x.f)(),a=e.auth.logged;return r.a.createElement("div",{className:"header"},r.a.createElement("div",{className:"logo"},"Chatick"),a?r.a.createElement("div",{className:"actions"},r.a.createElement("a",{href:"#",onClick:function(a){a.preventDefault(),e.logout(),t.push("/")}},"Logout")):r.a.createElement("div",{className:"actions"},r.a.createElement(F.b,{to:"/registration"},"Sign Up")))})),q=a(4),G=a(6);var D=P((function(e){var t=Object(x.f)();Object(s.useEffect)((function(){e.auth.logged&&t.push("/chat")}),[e.auth.logged]);var a=Object(s.useState)({email:"",password:""}),n=Object(G.a)(a,2),c=n[0],o=n[1],m=function(e){o(Object(l.a)({},c,Object(q.a)({},e.target.name,e.target.value)))};return r.a.createElement("div",{className:"page-wrapper sign-in form"},r.a.createElement("div",{className:"form"},r.a.createElement("div",{className:"form__title"},"LOGIN"),r.a.createElement("form",{onSubmit:function(t){t.preventDefault(),e.login(c.email,c.password)}},r.a.createElement("div",{className:"form-group"},r.a.createElement("label",{htmlFor:"email"},"Email address"),r.a.createElement("input",{type:"email",className:"form-control",name:"email",id:"email",autoComplete:"username",placeholder:"Enter email",value:c.email,onChange:m}),r.a.createElement("small",{id:"emailHelp",className:"form-text text-muted"},"We'll never share your email with anyone else.")),r.a.createElement("div",{className:"form-group"},r.a.createElement("label",{htmlFor:"password"},"Password"),r.a.createElement("input",{type:"password",className:"form-control",name:"password",id:"password",autoComplete:"current-password",placeholder:"Password",value:c.password,onChange:m})),r.a.createElement("div",{className:"form__buttons"},r.a.createElement("button",{type:"submit",className:"btn btn-primary w-100"},"Login")))))})),H=a(72);var T=P((function(e){var t=Object(x.f)(),a=Object(H.a)(),n=a.register,c=a.handleSubmit,o=(a.watch,a.errors,Object(s.useState)({firstName:"",lastName:"",email:"",password:""})),m=Object(G.a)(o,2),i=m[0],u=m[1],d=function(e){u(Object(l.a)({},i,Object(q.a)({},e.target.name,e.target.value)))};return r.a.createElement("div",{className:"page-wrapper sign-up"},r.a.createElement("div",{className:"form"},r.a.createElement("div",{className:"form__title"},"Registration"),r.a.createElement("form",{onSubmit:c((function(){N(i,(function(e){console.log(e)}))}))},r.a.createElement("div",{className:"form-group"},r.a.createElement("label",{htmlFor:"firstName"},"First Name"),r.a.createElement("input",{type:"text",className:"form-control",id:"firstName",name:"firstName",placeholder:"First Name",ref:n({required:!0}),onChange:d,value:i.firstName})),r.a.createElement("div",{className:"form-group"},r.a.createElement("label",{htmlFor:"lastName"},"Last Name"),r.a.createElement("input",{type:"text",className:"form-control",id:"lastName",name:"lastName",placeholder:"Last Name",onChange:d,value:i.lastName})),r.a.createElement("div",{className:"form-group"},r.a.createElement("label",{htmlFor:"email"},"Email address"),r.a.createElement("input",{type:"email",className:"form-control",id:"email",name:"email",autoComplete:"username",placeholder:"Enter email",onChange:d,value:i.email})),r.a.createElement("div",{className:"form-group"},r.a.createElement("label",{htmlFor:"password"},"Password"),r.a.createElement("input",{type:"password",className:"form-control",id:"password",name:"password",placeholder:"Password",autoComplete:"current-password",onChange:d,value:i.password})),r.a.createElement("div",{className:"form__buttons"},r.a.createElement("button",{type:"submit",className:"btn btn-primary"},"Registration"),r.a.createElement("button",{onClick:function(){t.push("/")},className:"btn btn-dark"},"Cancel")))))})),z=a(5),U=a(20),R=a(21),B=a(23),J=a(22),K=a(24);var W={addSize:function(){document.querySelector("#app");var e=document.querySelector(".header"),t=document.querySelector(".chat__send-area"),a=document.querySelector(".page-wrapper"),s=document.querySelector(".chat .messages"),r=document.querySelector(".chat .chat__header");function n(){if(e&&t&&a&&s&&r){var n=e.clientHeight,c=t.clientHeight,o=r.clientHeight;a.style.paddingTop="".concat(n,"px"),s.style.height="calc(100% - ".concat(c+o,"px)")}}n(),window.addEventListener("resize",(function(){n()}))},scrollMessage:function(){var e=document.querySelector(".chat .messages");e&&(e.scrollTop=e.scrollHeight)}},A=a(17),V=a.n(A),Q=function(e){function t(){return Object(U.a)(this,t),Object(B.a)(this,Object(J.a)(t).apply(this,arguments))}return Object(K.a)(t,e),Object(R.a)(t,[{key:"render",value:function(){var e=this,t=this.props.messages.map((function(t,a){var s=!1;return s=t.userId===e.props.auth.userId,r.a.createElement("div",{key:a,className:s?"messages__item messages__item--my-message":"messages__item"},r.a.createElement("div",{className:"messages__photo"},r.a.createElement("img",{src:V.a,alt:""}),r.a.createElement("div",{className:"user-status user-status--online"})),r.a.createElement("div",{className:"messages__block"},r.a.createElement("div",{className:"messages__author"},t.firstName+" "+t.lastName,r.a.createElement("span",{className:"messages__time"},"8min")),r.a.createElement("div",{className:"messages__text"},t.message,r.a.createElement("div",{className:"messages__read-message"},r.a.createElement("i",{className:"icofont-check-alt"})))))}));return r.a.createElement("div",{className:"chat"},r.a.createElement("div",{className:"chat__header"},r.a.createElement("div",{className:"chat__head-text"},"@General chat"),r.a.createElement("div",{className:"chat__close"},r.a.createElement("i",{className:"icofont-close-line"}))),r.a.createElement("div",{className:"messages"},t),r.a.createElement("div",{className:"chat__send-area"},r.a.createElement("div",{className:"chat__typing"},r.a.createElement("span",null,"Petya and Valera are typing")),r.a.createElement("div",{className:"chat__textarea-wrap"},r.a.createElement("div",{className:"chat__expressionless"},r.a.createElement("i",{className:"icofont-expressionless"})),r.a.createElement("input",{type:"text",className:"chat__input-message",placeholder:"Enter your message",onChange:this.props.handleChange,value:this.props.state.messageInput,onKeyPress:this.props.keyPressed})),r.a.createElement("div",{className:"chat__send-message",onClick:function(){e.props.sendMessage()}},r.a.createElement("i",{className:"icofont-paper-plane"}))))}}]),t}(s.Component),X=P(function(e){function t(e){var a;return Object(U.a)(this,t),(a=Object(B.a)(this,Object(J.a)(t).call(this,e)))._isMounted=!1,a.keyPressed=function(e){"Enter"===e.key&&a.sendMessage()},a.handleChange=function(e){var t=a.state;t.messageInput=e.target.value.replace(/\n/g,""),a.setState(Object(l.a)({},t))},a.state={socketIdPrev:"",messageInput:"",messages:[]},a.props.socket.on("connect",(function(){})),a}return Object(K.a)(t,e),Object(R.a)(t,[{key:"componentDidMount",value:function(){var e=this;W.addSize(),this.props.auth.logged&&(this._isMounted=!0,this.props.socket.on("message",(function(t){var a=e.state;a.messages=[].concat(Object(z.a)(a.messages),[{message:t.messageInput,userId:t.userId,firstName:t.firstName,lastName:t.lastName}]),e._isMounted&&e.setState(Object(l.a)({},a)),W.scrollMessage()})),this.props.socket.id!==this.state.socketIdPrev&&this.props.socket.emit("getGeneralMessage"),this.props.socket.on("getGeneralMessage",(function(t){if(e.props.socket.id!==e.state.socketIdPrev){var a=e.state;a.socketIdPrev=e.props.socket.id,a.messages=t,e._isMounted&&e.setState(Object(l.a)({},a)),W.scrollMessage()}})))}},{key:"componentWillUnmount",value:function(e){this._isMounted=!1}},{key:"sendMessage",value:function(){if(""!==this.state.messageInput){this.props.socket.emit("message",{messageInput:this.state.messageInput,userId:this.props.auth.userId,firstName:this.props.auth.firstName,lastName:this.props.auth.lastName});var e=this.state;e.messageInput="",this.setState(Object(l.a)({},e))}}},{key:"render",value:function(){return r.a.createElement(Q,{messages:this.state.messages,state:this.state,auth:this.props.auth,handleChange:this.handleChange,keyPressed:this.keyPressed,sendMessage:this.sendMessage})}}]),t}(s.Component)),Y=P((function(e){var t=Object(s.useState)({users:[],usersConnect:[],socketId:"",socketIdPrev:""}),a=Object(G.a)(t,2),n=a[0],c=a[1];Object(s.useEffect)((function(){e.auth.logged&&(e.socket.emit("userConnect",{userId:e.auth.userId}),e.socket.on("userConnect",(function(e){var t=n;t.users=[],e.users.map((function(a){e.usersConnect.map((function(e){a._id===e.userId&&(a.socketId=e.socketId)})),t.users.push(a)})),c(Object(l.a)({},t))})))}),[e.auth.logged,window]);var o=n.users.map((function(t,a){if(t._id!==e.auth.userId)return r.a.createElement(F.b,{key:a,to:"/chat/".concat(t._id).concat(t.socketId?"/"+t.socketId:"")},r.a.createElement("div",{className:"users__item"},r.a.createElement("div",{className:"users__photo"},r.a.createElement("img",{src:V.a,alt:""}),r.a.createElement("div",{className:t.socketId?"user-status user-status--online":"user-status"})),r.a.createElement("div",{className:"users__info"},r.a.createElement("div",{className:"users__name"},t.firstName," ",t.lastName,r.a.createElement("span",{className:"users__time"},"8min")),r.a.createElement("div",{className:"users__last-message"},"Hey last, can"))))}));return r.a.createElement("div",{className:"users"},r.a.createElement("div",{className:"users__profile"},r.a.createElement("div",{className:"users__item"},r.a.createElement("div",{className:"users__photo"},r.a.createElement("img",{src:V.a,alt:""})),r.a.createElement("div",{className:"users__info"},r.a.createElement("div",{className:"users__name"},e.auth.firstName," ",e.auth.lastName),r.a.createElement("div",{className:"users__status-text"},"Status")),r.a.createElement("div",{className:"users__notification"},r.a.createElement("i",{className:"icofont-notification"})))),r.a.createElement("div",{className:"users__search"},r.a.createElement("input",{type:"text",className:"users__search-input",placeholder:"Search"})),o)})),Z=function(e){function t(e){var a;return Object(U.a)(this,t),(a=Object(B.a)(this,Object(J.a)(t).call(this,e)))._isMounted=!1,a.keyPressed=function(e){"Enter"===e.key&&a.sendMessage()},a.handleChange=function(e){var t=a.state;t.messageInput=e.target.value.replace(/\n/g,""),a.setState(Object(l.a)({},t))},a.state={socketIdPrev:"",messageInput:"",messages:[]},a}return Object(K.a)(t,e),Object(R.a)(t,[{key:"componentDidMount",value:function(){var e=this;W.addSize(),this.props.auth.logged&&(this._isMounted=!0,this.props.socket.on("privateMessage",(function(t){if(t.userFromId===e.props.auth.userId||t.userFromId===e.props.match.params.userId){var a=e.state;a.messages=[].concat(Object(z.a)(a.messages),[{message:t.messageInput,userId:t.userFromId,firstName:t.firstName,lastName:t.lastName}]),e._isMounted&&e.setState(Object(l.a)({},a)),W.scrollMessage()}})),this.props.socket.id!==this.state.socketIdPrev&&this.props.socket.emit("getPrivateMessage",{userFromId:this.props.auth.userId,userToId:this.props.match.params.userId}),this.props.socket.on("getPrivateMessage",(function(t){if(e.props.socket.id!==e.state.socketIdPrev){var a=e.state;a.socketIdPrev=e.props.socket.id,a.messages=t,e._isMounted&&e.setState(Object(l.a)({},a)),W.scrollMessage()}})))}},{key:"componentWillUnmount",value:function(e){this._isMounted=!1}},{key:"componentDidUpdate",value:function(e,t){if(e.match.params.userId!==this.props.match.params.userId){var a=this.state;a.messages=[],this.setState(Object(l.a)({},a)),this.props.socket.emit("getPrivateMessage",{userFromId:this.props.auth.userId,userToId:this.props.match.params.userId})}}},{key:"sendMessage",value:function(){if(""!==this.state.messageInput){this.props.socket.emit("privateMessage",{messageInput:this.state.messageInput,userFromId:this.props.auth.userId,userToId:this.props.match.params.userId,firstName:this.props.auth.firstName,lastName:this.props.auth.lastName,socketId:this.props.match.params.socketId});var e=this.state;e.messageInput="",this.setState(Object(l.a)({},e))}}},{key:"render",value:function(){return r.a.createElement(Q,{messages:this.state.messages,state:this.state,auth:this.props.auth,handleChange:this.handleChange,keyPressed:this.keyPressed,sendMessage:this.sendMessage})}}]),t}(s.Component),$=P(Object(x.h)(Z)),ee=a(73),te=a.n(ee)()(E);var ae=P((function(e){var t=Object(x.f)(),a=Object(s.useState)({socket:void 0}),n=Object(G.a)(a,2);return n[0],n[1],Object(s.useEffect)((function(){e.auth.logged||t.push("/")}),[e.auth.logged]),te?r.a.createElement("div",{className:"page-wrapper chat-wrapper"},r.a.createElement("div",{className:"container-fluid h-100"},r.a.createElement("div",{className:"row h-100"},r.a.createElement("div",{className:"col-md-3 h-100 px-0"},r.a.createElement(Y,{socket:te})),r.a.createElement("div",{className:"col-md-6 h-100 px-0"},r.a.createElement(x.c,null,r.a.createElement(x.a,{path:"/chat/:userId/:socketId"},r.a.createElement($,{socket:te,useParams:x.g})),r.a.createElement(x.a,{path:"/chat/:userId"},r.a.createElement($,{socket:te,useParams:x.g})),r.a.createElement(x.a,{path:"/chat"},r.a.createElement(X,{socket:te})))),r.a.createElement("div",{className:"col-md-3 h-100 px-0"},r.a.createElement("div",{className:"details"}))))):r.a.createElement("div",null,"loading")}));var se=P((function(e){return Object(s.useEffect)((function(){e.checkLogged()}),[]),r.a.createElement(F.a,null,r.a.createElement(L,null),r.a.createElement(x.c,null,r.a.createElement(x.a,{path:"/chat",component:ae}),r.a.createElement(x.a,{path:"/registration",component:T}),r.a.createElement(x.a,{path:"/",component:D})))})),re=(a(130),a(131),a(132),Object(m.d)(j,Object(m.a)(i.a)));c.a.render(r.a.createElement(o.a,{store:re},r.a.createElement(se,null)),document.getElementById("app"))},17:function(e,t,a){e.exports=a.p+"static/media/ava.e4c49134.png"},74:function(e,t,a){e.exports=a(133)}},[[74,1,2]]]);
//# sourceMappingURL=main.7b0a3851.chunk.js.map