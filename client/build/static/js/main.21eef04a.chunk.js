(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[0],{126:function(e,t){},130:function(e,t,a){},131:function(e,t,a){"use strict";a.r(t);var s=a(0),n=a.n(s),r=a(26),o=a.n(r),c=a(31),l=a(16),i=a(69),m=a(3),u="LOGIN",d="CHECK_LOGGED",p="LOGOUT",g=a(17),h=a.n(g),f="".concat(window.location.protocol,"/api/v1/"),v="".concat(window.location.host),N=function(e,t){h.a.post(f+"register-user",e).then((function(e){t(e)}))},b=function(e,t){h.a.post(f+"login",e).then((function(e){t(e)}))},E=a(42),O=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:window.localStorage.getItem("token"),t={};if(e){var a=e;t.token=a;(a=(a=a.replace("Bearer ","")).split("."))[0];var s=a[1];a[2];s=JSON.parse(E.Base64.decode(s)),t.userId=s.userId,t.firstName=s.firstName,t.lastName=s.lastName,t.email=s.email,h.a.defaults.headers.common.Authorization=e,t.logged=!0,localStorage.setItem("token",e)}return t},k={login:function(e,t){var a=this;return function(s){b({email:e,password:t},(function(e){var t=O(e.data);s(a.loginRequest(Object(m.a)({type:u},t)))}))}},loginRequest:function(e){return e},checkLogged:function(){var e=O();return Object(m.a)({type:d},e)},logout:function(){return{type:p}}},j={logged:!1,token:void 0,userId:"",firstName:"",lastName:"",email:""};var w=Object(l.c)({auth:function(e,t){if("undefined"===typeof e)return j;switch(t.type){case u:e=Object(m.a)({},t);break;case d:t.token?e=Object(m.a)({},t):(e.token=void 0,e.logged=!1);break;case p:window.localStorage.removeItem("token"),h.a.defaults.headers.common.Authorization="",e.token=void 0,e.logged=!1}return e}}),y=Object(m.a)({},k),_=function(e){return Object(m.a)({},e)},I=Object(m.a)({},y),S=function(e){return Object(c.b)(_,I)(e)},C=a(14),M=a(15);var L=S((function(e){var t=Object(C.f)(),a=e.auth.logged;return n.a.createElement("div",{className:"header"},n.a.createElement("div",{className:"logo"},"Chatick"),a?n.a.createElement("div",{className:"actions"},n.a.createElement("a",{href:"#",onClick:function(a){a.preventDefault(),e.logout(),t.push("/")}},"Logout")):n.a.createElement("div",{className:"actions"},n.a.createElement(M.b,{to:"/registration"},"Sign Up")))})),P=a(4),q=a(11);var x=S((function(e){var t=Object(C.f)();Object(s.useEffect)((function(){e.auth.logged&&t.push("/chatWrapper")}),[e.auth.logged]);var a=Object(s.useState)({email:"",password:""}),r=Object(q.a)(a,2),o=r[0],c=r[1],l=function(e){c(Object(m.a)({},o,Object(P.a)({},e.target.name,e.target.value)))};return n.a.createElement("div",{className:"page-wrapper sign-in form"},n.a.createElement("div",{className:"form"},n.a.createElement("div",{className:"form__title"},"LOGIN"),n.a.createElement("form",{onSubmit:function(t){t.preventDefault(),e.login(o.email,o.password)}},n.a.createElement("div",{className:"form-group"},n.a.createElement("label",{htmlFor:"email"},"Email address"),n.a.createElement("input",{type:"email",className:"form-control",name:"email",id:"email",autoComplete:"username",placeholder:"Enter email",value:o.email,onChange:l}),n.a.createElement("small",{id:"emailHelp",className:"form-text text-muted"},"We'll never share your email with anyone else.")),n.a.createElement("div",{className:"form-group"},n.a.createElement("label",{htmlFor:"password"},"Password"),n.a.createElement("input",{type:"password",className:"form-control",name:"password",id:"password",autoComplete:"current-password",placeholder:"Password",value:o.password,onChange:l})),n.a.createElement("div",{className:"form__buttons"},n.a.createElement("button",{type:"submit",className:"btn btn-primary w-100"},"Login")))))})),F=a(71);var G=S((function(e){var t=Object(C.f)(),a=Object(F.a)(),r=a.register,o=a.handleSubmit,c=(a.watch,a.errors,Object(s.useState)({firstName:"",lastName:"",email:"",password:""})),l=Object(q.a)(c,2),i=l[0],u=l[1],d=function(e){u(Object(m.a)({},i,Object(P.a)({},e.target.name,e.target.value)))};return n.a.createElement("div",{className:"page-wrapper sign-up"},n.a.createElement("div",{className:"form"},n.a.createElement("div",{className:"form__title"},"Registration"),n.a.createElement("form",{onSubmit:o((function(){N(i,(function(e){console.log(e)}))}))},n.a.createElement("div",{className:"form-group"},n.a.createElement("label",{htmlFor:"firstName"},"First Name"),n.a.createElement("input",{type:"text",className:"form-control",id:"firstName",name:"firstName",placeholder:"First Name",ref:r({required:!0}),onChange:d,value:i.firstName})),n.a.createElement("div",{className:"form-group"},n.a.createElement("label",{htmlFor:"lastName"},"Last Name"),n.a.createElement("input",{type:"text",className:"form-control",id:"lastName",name:"lastName",placeholder:"Last Name",onChange:d,value:i.lastName})),n.a.createElement("div",{className:"form-group"},n.a.createElement("label",{htmlFor:"email"},"Email address"),n.a.createElement("input",{type:"email",className:"form-control",id:"email",name:"email",autoComplete:"username",placeholder:"Enter email",onChange:d,value:i.email})),n.a.createElement("div",{className:"form-group"},n.a.createElement("label",{htmlFor:"password"},"Password"),n.a.createElement("input",{type:"password",className:"form-control",id:"password",name:"password",placeholder:"Password",autoComplete:"current-password",onChange:d,value:i.password})),n.a.createElement("div",{className:"form__buttons"},n.a.createElement("button",{type:"submit",className:"btn btn-primary"},"Registration"),n.a.createElement("button",{onClick:function(){t.push("/")},className:"btn btn-dark"},"Cancel")))))})),U=a(5),z=a(28),D=a(29),H=a(32),W=a(30),R=a(33);var B={addSize:function(){document.querySelector("#app");var e=document.querySelector(".header"),t=document.querySelector(".chat__send-area"),a=document.querySelector(".page-wrapper"),s=document.querySelector(".chat .messages");function n(){if(e&&t&&a&&s){var n=e.clientHeight,r=t.clientHeight;a.style.paddingTop="".concat(n,"px"),s.style.height="calc(100% - ".concat(r,"px)")}}n(),window.addEventListener("resize",(function(){n()}))},scrollMessage:function(){var e=document.querySelector(".chat .messages");e&&(e.scrollTop=e.scrollHeight)}},J=S(function(e){function t(e){var a;return Object(z.a)(this,t),(a=Object(H.a)(this,Object(W.a)(t).call(this,e)))._isMounted=!1,a.keyPressed=function(e){"Enter"===e.key&&a.sendMessage()},a.handleChange=function(e){var t=a.state;t.messageInput=e.target.value.replace(/\n/g,""),a.setState(Object(m.a)({},t))},a.state={socketIdPrev:"",messageInput:"",messages:[]},a.props.socket.on("connect",(function(){})),a}return Object(R.a)(t,e),Object(D.a)(t,[{key:"componentDidMount",value:function(){var e=this;B.addSize(),this.props.auth.logged&&(this._isMounted=!0,this.props.socket.on("message",(function(t){var a=e.state;a.messages=[].concat(Object(U.a)(a.messages),[{message:t.messageInput,userId:t.userId,firstName:t.firstName,lastName:t.lastName}]),e._isMounted&&e.setState(Object(m.a)({},a)),B.scrollMessage()})),this.props.socket.id!==this.state.socketIdPrev&&this.props.socket.emit("getGeneralMessage"),this.props.socket.on("getGeneralMessage",(function(t){if(e.props.socket.id!==e.state.socketIdPrev){var a=e.state;a.socketIdPrev=e.props.socket.id,a.messages=t,e._isMounted&&e.setState(Object(m.a)({},a)),B.scrollMessage()}})))}},{key:"componentWillUnmount",value:function(e){this._isMounted=!1}},{key:"sendMessage",value:function(){if(""!==this.state.messageInput){this.props.socket.emit("message",{messageInput:this.state.messageInput,userId:this.props.auth.userId,firstName:this.props.auth.firstName,lastName:this.props.auth.lastName});var e=this.state;e.messageInput="",this.setState(Object(m.a)({},e))}}},{key:"render",value:function(){var e=this,t=this.state.messages.map((function(t,a){var s=!1;return s=t.userId===e.props.auth.userId,n.a.createElement("div",{key:a,className:s?"messages__item messages__item--my-message":"messages__item"},n.a.createElement("div",{className:"messages__author"},s?"":t.firstName+" "+t.lastName+":"),n.a.createElement("div",{className:"messages__text"},t.message))}));return n.a.createElement("div",{className:"chat"},n.a.createElement("div",{className:"messages"},t),n.a.createElement("div",{className:"chat__send-area"},n.a.createElement("textarea",{className:"chat__input-message form-control",onChange:this.handleChange,value:this.state.messageInput,onKeyPress:this.keyPressed}),n.a.createElement("button",{className:"chat__send-message btn btn-primary",onClick:function(){e.sendMessage()}},"Send")))}}]),t}(s.Component)),T=S(function(e){function t(e){var a;return Object(z.a)(this,t),(a=Object(H.a)(this,Object(W.a)(t).call(this,e)))._isMounted=!1,a.handleChange=function(e){var t=a.state;t.messageInput=e.target.value,a.setState(Object(m.a)({},t))},a.state={users:[]},a}return Object(R.a)(t,e),Object(D.a)(t,[{key:"componentDidMount",value:function(){var e=this;this._isMounted=!0,this.props.auth.logged&&this.props.socket.emit("getUsers"),this.props.socket.on("getUsers",(function(t){var a=e.state;a.users=t,e._isMounted&&e.setState(Object(m.a)({},a))}))}},{key:"componentWillUnmount",value:function(){this._isMounted=!1}},{key:"sendMessage",value:function(){this.props.socket.emit("message",{messageInput:this.state.messageInput,userId:this.props.auth.userId})}},{key:"render",value:function(){var e=this.state.users.map((function(e,t){return n.a.createElement("div",{key:t,className:""},e.firstName," ",e.lastName)}));return n.a.createElement("div",{className:"GeneralChat"},e)}}]),t}(s.Component)),A=a(72),K=a.n(A)()(v);var Q=S((function(e){var t=Object(C.f)();return Object(s.useEffect)((function(){e.auth.logged||t.push("/")}),[e.auth.logged]),n.a.createElement("div",{className:"page-wrapper chat-wrapper"},n.a.createElement("div",{className:"container-fluid h-100"},n.a.createElement("div",{className:"row h-100"},n.a.createElement("div",{className:"col-md-3 h-100"},n.a.createElement(T,{socket:K})),n.a.createElement("div",{className:"col-md-6 h-100"},n.a.createElement(J,{socket:K})))))}));var V=S((function(e){return Object(s.useEffect)((function(){e.checkLogged()}),[]),n.a.createElement(M.a,null,n.a.createElement(L,null),n.a.createElement(C.c,null,n.a.createElement(C.a,{path:"/chatWrapper",component:Q}),n.a.createElement(C.a,{path:"/registration",component:G}),n.a.createElement(C.a,{path:"/",component:x})))})),X=(a(129),a(130),Object(l.d)(w,Object(l.a)(i.a)));o.a.render(n.a.createElement(c.a,{store:X},n.a.createElement(V,null)),document.getElementById("app"))},73:function(e,t,a){e.exports=a(131)}},[[73,1,2]]]);
//# sourceMappingURL=main.21eef04a.chunk.js.map